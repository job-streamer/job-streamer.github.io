<!DOCTYPE html>
<html lang="ja">
   <head>
      <meta charset="UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta name="description" content="JobStreamer : JobStreamer site."/>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.1.8/semantic.min.css" type="text/css"/>
      <link rel="stylesheet" href="css/basic.css" type="text/css"/>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/prism/1.5.0/themes/prism.css" type="text/css"/>
   </head>
   <body>
<div class="ui sidebar inverted vertical menu">
   <a class="item" href="get-started-quickly.html">
   Getting Started
   </a>
   <div class="item">
      <div class="header">ガイド</div>
      <div class="menu">
         <a class="item" href="deploy-batch-components.html">
         バッチコンポーネントのデプロイ
         </a>
         <a class="item" href="create-a-job.html">
         ジョブの作成
         </a>
         <a class="item" href="execute-the-job.html">
         ジョブの手動実行
         </a>
         <a class="item" href="schedule-job.html">
         ジョブのスケジュール実行
         </a>
         <a class="item" href="job-config.html">
         ジョブの設定
         </a>
         <a class="item" href="notificator-config.html">
         Notificatorの設定
         </a>
      </div>
   </div>
   <div class="item">
      <div class="header">コンポーネント</div>
      <div class="menu">
         <a class="item" href="control-bus.html">
         Control bus
         </a>
         <a class="item" href="agent.html">
         Agent
         </a>
         <a class="item" href="console.html">
         Management console
         </a>
         <a class="item" href="notificator.html">
         Notificator
         </a>
      </div>
   </div>
   <div class="item">
      <div class=" header">開発者向け情報</div>
      <div class="menu">
         <a class="item" href="get-started-developer.html">
         REPLコマンド集
         </a>
         <a class="item" href="developer-guide.html">
         ディベロッパーガイド
         </a>
      </div>
   </div>
</div>      <div class="pusher">
         <div class="ui fixed inverted teal menu">
            <div class="title item"><a href="./index.html"><b>Job Streamer</b></a></div>
            <a class="view-ui item" onClick="viewSidebar()">
              Menu
            </a>
         </div>
         <div id="main_content_wrap" class="main grid content full height">
      <h1>Control-bus</h1><h2>Control-busとは？</h2><p>control-busはAPI呼び出しを制御しています。<br/>すべてのAPI呼び出しはcontrol-busを介して行います。<br/>なので直接console-&gt;agentといったAPIアクセスが発生することはありません。</p><h2>Control-busで出来ること</h2>
<ul>
  <li>バッチ部品のデプロイ</li>
  <li>ジョブの登録</li>
  <li>ジョブの削除</li>
  <li>ジョブの変更</li>
  <li><p>ジョブの実行</p></li>
  <li>ジョブの停止</li>
  <li>ジョブの再実行</li>
  <li><p>カレンダーの作成</p></li>
  <li>カレンダーの削除</li>
  <li>カレンダーの更新</li>
  <li><p>ジョブのスケジューリング</p></li>
  <li>ジョブのスケジュールの停止</li>
  <li>ジョブのスケジューリングの削除</li>
</ul><h2>Control-bus APIs</h2><p>Control-busのAPIはednとJSONに対応しています.</p><h3><a href="#create-a-appliccation" name="create-a-appliccation">Create a appliccation</a></h3>
<pre><code>POST /apps
</code></pre><h4><a href="#example" name="example">Example</a></h4>
<pre><code class="clojure">{
  :name &quot;batch-example&quot;
  :description &quot;Batch example&quot;
  :classpath [
    &quot;file:///home/app/target/classes&quot;
    &quot;file:///var/m2/repository/xxx/xxx.jar&quot;
    &quot;file:///var/m2/repository/yyy/yyy.jar&quot;
    &quot;file:///var/m2/repository/zzz/zzz.jar&quot;
  ]
}
</code></pre><p><code>NOTICE</code></p>
<blockquote><p>Currently, JobStreamer supports only single application.</p>
</blockquote><h3><a href="#list-jobs" name="list-jobs">List jobs</a></h3>
<pre><code>GET /:app-name/jobs
</code></pre><h4><a href="#query" name="query">Query</a></h4><p>jobを条件検索したい場合は以下のようにパラメータを付加することでできます。</p>
<pre><code>GET /:app-name/jobs?q=[query]
</code></pre><p>queryでは基本的にスペース区切りでjob名を指定することで、部分一致検索を行います。<br/>それ以外にもプレフィックスをつけることで様々な検索が可能です。</p>
<table>
  <thead>
    <tr>
      <th>prefix</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>exit-status:</td>
      <td>最終実行のexit-statusとパラメータが部分一致するかどうか</td>
    </tr>
    <tr>
      <td>since:</td>
      <td>最終実行の終了時刻(yyyy-MM-dd)がパラメータ以降であるかどうか</td>
    </tr>
    <tr>
      <td>until:</td>
      <td>最終実行の終了時刻(yyyy-MM-dd)がパラメータ以前であるかどうか</td>
    </tr>
  </tbody>
</table><h5><a href="#example" name="example">Example</a></h5><p>encoded</p>
<pre><code>GET /:app-name/jobs?q=send%20mail%20since%3a2000%2d01%2d01%20until%3a2100%2d01%2d01
</code></pre><p>not encoded</p>
<pre><code>GET /:app-name/jobs?q=send mail since:2000-01-01 until:2100-01-01
</code></pre><p>job名に　send か mail を含み jobの最終実行が2000-01-01から2100-01-01のjobが得られます。</p><h3><a href="#create-a-job" name="create-a-job">Create a job</a></h3>
<pre><code>POST /:app-name/jobs
</code></pre><h4><a href="#parameters" name="parameters">Parameters</a></h4>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>job/name</td>
      <td>String</td>
      <td>Required. The name of the job.</td>
    </tr>
    <tr>
      <td>job/components</td>
      <td>Map</td>
      <td>Required. The components of the job.</td>
    </tr>
    <tr>
      <td>job/properties</td>
      <td>Map</td>
      <td>Required but accept null. The properties of the job.</td>
    </tr>
    <tr>
      <td>step/name</td>
      <td>String</td>
      <td>Required. The name of the step.</td>
    </tr>
    <tr>
      <td>step/properties</td>
      <td>Map</td>
      <td>Required but accept null. The properties of the step.</td>
    </tr>
  </tbody>
</table><h4><a href="#example" name="example">Example</a></h4><p>edn</p>
<pre><code class="clojure">{
  :job/name &quot;example-job&quot;
  :job/components [{
    :step/name &quot;example-step&quot;
    :step/properties nil
    :step/batchlet {
      :batchlet/ref &quot;example.HelloBatch&quot;
      }}]
  :job/properties {:key &quot;value&quot;}}
</code></pre><p>JSON</p>
<pre><code class="JSON">{
  &quot;job/name&quot;: &quot;example-job&quot;,
  &quot;job/components&quot;: [
    {
      &quot;step/name&quot;: &quot;example-step&quot;,
      &quot;step/properties&quot;: null,
      &quot;step/batchlet&quot;: {
        &quot;batchlet/ref&quot;: &quot;example.HelloBatch&quot;
      }
    }
  ],
  &quot;job/properties&quot;: {
      &quot;key&quot;: &quot;value&quot;
  }
}
</code></pre><h3><a href="#get-a-single-job" name="get-a-single-job">Get a single job</a></h3>
<pre><code>GET /:app-name/job/:job-name
</code></pre><h4><a href="#response" name="response">Response</a></h4>
<pre><code class="clojure">{
  :db/id 17592186045451
  :job/stats {
    :total 49
    :success 39
    :failure 3
    :average 2660/39
  }
  :job/schedule {
    :schedule/active? true
    :schedule/cron-notation &quot;0 0 * * * ?&quot;
  }
  :job/restartable? true
  :job/name &quot;MyShell&quot;
  :job/next-execution {
    :job-execution/start-time #inst &quot;2015-04-13T09:00:00.000-00:00&quot;
  }
  :job/latest-execution {
    :job-execution/batch-status {:db/ident :batch-status/queued}
    :job-execution/create-time #inst &quot;2015-04-13T07:00:00.006-00:00&quot;
  }
}
</code></pre><h3><a href="#update-a-job" name="update-a-job">Update a job</a></h3>
<pre><code>PUT /:app-name/job/:job-name
</code></pre><h4><a href="#inputs" name="inputs">Inputs</a></h4><p>reffer <a href="#create-a-job">Creare a job</a></p><h3><a href="#delete-a-job" name="delete-a-job">Delete a job</a></h3>
<pre><code>DELETE /:app-name/job/:job-name
</code></pre><h3><a href="#create-a-calendar" name="create-a-calendar">Create a calendar</a></h3>
<pre><code>POST /calendars
</code></pre><h4><a href="#input" name="input">Input</a></h4>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>calendar/name</td>
      <td>String</td>
      <td>Required. Name of calenar.</td>
    </tr>
    <tr>
      <td>calendar/weekly-holiday</td>
      <td>Array</td>
      <td>Required. Weekly holiday of calendar.</td>
    </tr>
    <tr>
      <td>calendar/holidays</td>
      <td>Array</td>
      <td>Not Required. Holidays of calendar.</td>
    </tr>
  </tbody>
</table><p>edn</p>
<pre><code class="clojure">{
  :calendar/name &quot;example&quot;
  :calendar/weekly-holiday [true false false false false false true]
  :calendar/holidays [#inst &quot;2016-09-15T15:00:00.000-00:00&quot;]
  :new? true
}
</code></pre><p>JSON</p>
<pre><code class="JSON">{
  &quot;calendar/name&quot;: &quot;example&quot;
  &quot;calendar/weekly-holiday&quot;: [true false false false false false true]
  &quot;calendar/holidays&quot; [&quot;2016-09-15&quot;]
  :new? true
}
</code></pre><h3><a href="#list-calendars" name="list-calendars">List calendars</a></h3>
<pre><code>GET /calendars
</code></pre><h3><a href="#update-calendar" name="update-calendar">Update calendar</a></h3>
<pre><code>PUT /calendar/:calendar-name

</code></pre><h3><a href="#delete-calendar" name="delete-calendar">Delete calendar</a></h3>
<pre><code>DELETE /calendar/:calendar-name
</code></pre><h3><a href="#schedule-a-job" name="schedule-a-job">Schedule a job</a></h3>
<pre><code>POST /:app-name/job/:job-name/schedule
</code></pre><h4><a href="#input" name="input">Input</a></h4>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>schedule/cron-notation</td>
      <td>String</td>
      <td>Required. A schedule by the cron notation.</td>
    </tr>
    <tr>
      <td>schedule/calendar</td>
      <td>Map</td>
      <td>Not Required. A schedule by calendar.</td>
    </tr>
    <tr>
      <td>calendar/name</td>
      <td>String</td>
      <td>Not Required. Name of calendar.</td>
    </tr>
  </tbody>
</table><p>edn</p>
<pre><code class="clojure">{
 :schedule/cron-notation &quot;0 0 * * * ?&quot;, :schedule/calendar {:calendar/name &quot;example&quot;}
}
</code></pre><p>JSON</p>
<pre><code class="JSON">{
 &quot;schedule/cron-notation&quot;: &quot;0 0 * * * ?&quot;
 &quot;:schedule/calendar&quot;:{
   &quot;calendar/name&quot;: &quot;example&quot;
 }
}
</code></pre><h3><a href="#execute-a-job" name="execute-a-job">Execute a job</a></h3>
<pre><code>POST /:app-name/job/:job-name/executions
</code></pre><h3><a href="#list-executions" name="list-executions">List executions</a></h3>
<pre><code>GET /:app-name/job/:job-name/executions
</code></pre><h4><a href="#response" name="response">Response</a></h4>
<pre><code class="clojure">[
  {
    :db/id 17592186045455
    :job-execution/execution-id 119
    :job-execution/create-time #inst &quot;2015-04-08T04:54:15.703-00:00&quot;
    :job-execution/start-time #inst &quot;2015-04-08T04:55:01.694-00:00&quot;
    :job-execution/end-time #inst &quot;2015-04-08T04:55:01.796-00:00&quot;
    :job-execution/agent {
      :agent/name &quot;agent-1&quot;
      :agent/instance-id #uuid &quot;5424c784-a145-4d3e-96f3-b9d99858611a&quot;
    }
    :job-execution/batch-status {:db/ident :batch-status/completed}
    :job-execution/job-parameters &quot;{}&quot;
  }
]
</code></pre><h3><a href="#delete-executions" name="delete-executions">Delete executions</a></h3>
<pre><code>DELETE /:app-name/job/:job-name/executions
</code></pre><h3><a href="#get-a-single-execution" name="get-a-single-execution">Get a single execution</a></h3>
<pre><code>GET /:app-name/job/:job-name/execution/:execution-id
</code></pre><h3><a href="#stop-a-execution" name="stop-a-execution">Stop a execution</a></h3>
<pre><code>PUT /:app-name/job/:job-name/execution/:execution-id/stop
</code></pre><h3><a href="#restart-a-execution" name="restart-a-execution">Restart a execution</a></h3>
<pre><code>PUT /:app-name/job/:job-name/execution/:execution-id/restart
</code></pre><h3><a href="#abandon-a-execution" name="abandon-a-execution">Abandon a execution</a></h3>
<pre><code>PUT /:app-name/job/:job-name/execution/:execution-id/abandon
</code></pre><h3><a href="#list-agents" name="list-agents">List agents</a></h3>
<pre><code>GET /agents
</code></pre><h4><a href="#response" name="response">Response</a></h4>
<pre><code class="clojure">[{
  :agent/name &quot;agent-1&quot;
  :agent/port 4510
  :agent/jobs {:running 0}
  :command :ready
  :agent/instance-id #uuid &quot;d7dd0172-d272-41a4-aad2-56318b2234ee&quot;
  :agent/cpu-arch &quot;amd64&quot;
  :agent/cpu-core 4
  :agent/os-name &quot;Linux&quot;
  :agent/stats {
    :memory {
      :physical {
        :free 1070014464
        :total 8281976832
      }
      :swap {
        :free 34325999616
        :total 34359734272
      }
    }
    :cpu {
      :process {
        :load 0.024032586558044806
        :time 13050000000
      }
      :system {
        :load 0.07780040733197556
        :load-average 2.43
      }
    }
  }
  :agent/os-version &quot;3.19.3-3-ARCH&quot;
  :agent/host &quot;127.0.0.1&quot;
  :agent/executions []
}]
</code></pre><h3><a href="#get-a-single-agent" name="get-a-single-agent">Get a single agent</a></h3>
<pre><code>GET /agent/:instance-id
</code></pre><h4><a href="#response" name="response">Response</a></h4>
<pre><code class="clojure">{
  :agent/name &quot;agent-1&quot;
  :agent/port 4510
  :agent/jobs {:running 0}
  :command :ready
  :agent/instance-id #uuid &quot;d7dd0172-d272-41a4-aad2-56318b2234ee&quot;
  :agent/cpu-arch &quot;amd64&quot;
  :agent/cpu-core 4
  :agent/os-name &quot;Linux&quot;
  :agent/stats {
    :memory {
      :physical {
        :free 1070014464
        :total 8281976832
      }
      :swap {
        :free 34325999616
        :total 34359734272
      }
    }
    :cpu {
      :process {
        :load 0.024032586558044806
        :time 13050000000
      }
      :system {
        :load 0.07780040733197556
        :load-average 2.43
      }
    }
  }
  :agent/os-version &quot;3.19.3-3-ARCH&quot;
  :agent/host &quot;127.0.0.1&quot;
  :agent/executions []
}
</code></pre><h3><a href="#get-statistics-of-control-bus" name="get-statistics-of-control-bus">Get statistics of control bus</a></h3>
<pre><code>GET /:app-name/stats
</code></pre><h4><a href="#response" name="response">Response</a></h4>
<pre><code class="clojure">{:agents 0, :jobs 3}
</code></pre><h2><a href="#github" name="github">GitHub</a></h2><p><a href="https://github.com/job-streamer/job-streamer-control-bus">https://github.com/job-streamer/job-streamer-control-bus</a></p>
         </div>
         <div class="ui inverted teal footer vertical segment">
            <div class="container">
               <div class="ui stackable divided relaxed grid">
                  <div class="sixteen wide column">
                     <p>Copyright @ 2015-2016 kawasima &amp; contributors.</p>
                     <p>Released under the EPL license.</p>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <script src="https://cdn.jsdelivr.net/jquery/1.12.3/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/prism/1.5.0/prism.js"></script>
      <script src="https://cdn.jsdelivr.net/prism/1.5.0/components/prism-java.min.js"></script>
      <script src="https://cdn.jsdelivr.net/prism/1.5.0/components/prism-bash.min.js"></script>
      <script src="https://cdn.jsdelivr.net/prism/1.5.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
      <script src="https://cdn.jsdelivr.net/semantic-ui/2.1.8/semantic.min.js"> </script>
      <script type="text/javascript">
         function viewSidebar() {
           $('.sidebar')
             .sidebar('toggle');
         }
      </script>
   </body>
</html>
